<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web远程控制工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .screen-container {
            background: #020617;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        .connection-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .control-btn {
            transition: all 0.2s;
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .terminal-text {
            font-family: 'Courier New', monospace;
        }
        
        .drag-active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="h-screen overflow-hidden">

<!-- 角色选择界面 -->
<div id="roleSelection" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900">
    <div class="text-center space-y-8 p-8">
        <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent mb-4">
            Web Remote
        </h1>
        <p class="text-slate-400 text-lg mb-8">选择您的角色开始使用</p>
        
        <div class="flex gap-6 justify-center">
            <button onclick="selectRole('controller')" class="group relative w-64 h-80 rounded-2xl bg-slate-800 border border-slate-700 hover:border-blue-500 transition-all duration-300 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-blue-600/20 to-purple-600/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="relative z-10 flex flex-col items-center justify-center h-full p-6">
                    <i class="fas fa-desktop text-6xl text-blue-400 mb-4 group-hover:scale-110 transition-transform"></i>
                    <h3 class="text-2xl font-semibold mb-2">控制端</h3>
                    <p class="text-slate-400 text-sm text-center">远程控制其他设备</p>
                </div>
            </button>
            
            <button onclick="selectRole('controlled')" class="group relative w-64 h-80 rounded-2xl bg-slate-800 border border-slate-700 hover:border-green-500 transition-all duration-300 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-green-600/20 to-emerald-600/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="relative z-10 flex flex-col items-center justify-center h-full p-6">
                    <i class="fas fa-laptop text-6xl text-green-400 mb-4 group-hover:scale-110 transition-transform"></i>
                    <h3 class="text-2xl font-semibold mb-2">被控端</h3>
                    <p class="text-slate-400 text-sm text-center">接受远程控制</p>
                </div>
            </button>
        </div>
    </div>
</div>

<!-- 控制端界面 -->
<div id="controllerUI" class="hidden h-full flex flex-col">
    <!-- 顶部工具栏 -->
    <header class="glass-panel border-b border-slate-700 px-6 py-3 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <div class="w-3 h-3 rounded-full bg-red-500 connection-dot" id="connectionStatus"></div>
            <span class="font-semibold text-slate-200">控制面板</span>
            <span id="sessionId" class="text-xs bg-slate-700 px-2 py-1 rounded text-slate-300 font-mono"></span>
        </div>
        
        <div class="flex items-center gap-3">
            <button onclick="toggleFullscreen()" class="control-btn p-2 rounded-lg hover:bg-slate-700 text-slate-300" title="全屏">
                <i class="fas fa-expand"></i>
            </button>
            <button onclick="requestScreen()" class="control-btn px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors">
                <i class="fas fa-sync-alt mr-2"></i>刷新画面
            </button>
            <button onclick="disconnect()" class="control-btn px-4 py-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg text-sm font-medium border border-red-600/30">
                <i class="fas fa-power-off mr-2"></i>断开
            </button>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        <!-- 左侧控制栏 -->
        <aside class="w-64 glass-panel border-r border-slate-700 flex flex-col">
            <div class="p-4 border-b border-slate-700">
                <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">连接设置</h3>
                <div class="space-y-3">
                    <input type="text" id="targetId" placeholder="输入被控端ID" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-500">
                    <button onclick="connectToTarget()" class="w-full bg-blue-600 hover:bg-blue-700 text-white rounded-lg py-2 text-sm font-medium transition-colors">
                        连接
                    </button>
                </div>
            </div>

            <div class="p-4 border-b border-slate-700">
                <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">快速操作</h3>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="sendCtrlAltDel()" class="control-btn p-3 bg-slate-800 rounded-lg hover:bg-slate-700 text-xs">
                        <i class="fas fa-keyboard mb-1 block text-lg"></i>
                        Ctrl+Alt+Del
                    </button>
                    <button onclick="lockScreen()" class="control-btn p-3 bg-slate-800 rounded-lg hover:bg-slate-700 text-xs">
                        <i class="fas fa-lock mb-1 block text-lg"></i>
                        锁屏
                    </button>
                    <button onclick="muteRemote()" class="control-btn p-3 bg-slate-800 rounded-lg hover:bg-slate-700 text-xs">
                        <i class="fas fa-volume-mute mb-1 block text-lg"></i>
                        静音
                    </button>
                    <button onclick="openTaskManager()" class="control-btn p-3 bg-slate-800 rounded-lg hover:bg-slate-700 text-xs">
                        <i class="fas fa-tasks mb-1 block text-lg"></i>
                        任务管理器
                    </button>
                </div>
            </div>

            <div class="p-4 flex-1">
                <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-3">文件传输</h3>
                <div id="dropZone" class="border-2 border-dashed border-slate-600 rounded-lg p-4 text-center hover:border-blue-500 transition-colors cursor-pointer" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-cloud-upload-alt text-3xl text-slate-500 mb-2"></i>
                    <p class="text-xs text-slate-400">点击或拖拽文件上传</p>
                    <input type="file" id="fileInput" class="hidden" onchange="handleFileSelect(event)">
                </div>
                <div id="transferList" class="mt-3 space-y-2 max-h-40 overflow-y-auto scrollbar-hide"></div>
            </div>
        </aside>

        <!-- 主屏幕区域 -->
        <main class="flex-1 flex flex-col bg-slate-950 relative">
            <div class="flex-1 screen-container relative overflow-hidden flex items-center justify-center" id="screenWrapper">
                <canvas id="remoteScreen" class="max-w-full max-h-full object-contain cursor-crosshair"></canvas>
                <div id="waitingScreen" class="absolute inset-0 flex items-center justify-center bg-slate-900/90">
                    <div class="text-center">
                        <i class="fas fa-desktop text-6xl text-slate-600 mb-4"></i>
                        <p class="text-slate-400">等待连接...</p>
                    </div>
                </div>
            </div>
            
            <!-- 底部状态栏 -->
            <div class="glass-panel border-t border-slate-700 px-4 py-2 flex items-center justify-between text-xs text-slate-400">
                <div class="flex items-center gap-4">
                    <span id="resolution">分辨率: --</span>
                    <span id="fps">FPS: --</span>
                    <span id="latency">延迟: --ms</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-mouse-pointer"></i>
                    <span id="mousePos">0, 0</span>
                </div>
            </div>
        </main>

        <!-- 右侧聊天/命令面板 -->
        <aside class="w-80 glass-panel border-l border-slate-700 flex flex-col">
            <div class="flex border-b border-slate-700">
                <button onclick="switchTab('chat')" class="flex-1 py-3 text-sm font-medium text-blue-400 border-b-2 border-blue-400" id="tabChat">聊天</button>
                <button onclick="switchTab('cmd')" class="flex-1 py-3 text-sm font-medium text-slate-400 hover:text-slate-200" id="tabCmd">终端</button>
            </div>
            
            <div id="chatPanel" class="flex-1 flex flex-col">
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-hide">
                    <div class="text-center text-xs text-slate-500 my-4">系统消息: 已连接到远程设备</div>
                </div>
                <div class="p-3 border-t border-slate-700">
                    <div class="flex gap-2">
                        <input type="text" id="chatInput" placeholder="输入消息..." class="flex-1 bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-blue-500" onkeypress="if(event.key==='Enter') sendChat()">
                        <button onclick="sendChat()" class="px-4 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="cmdPanel" class="hidden flex-1 flex flex-col">
                <div id="terminalOutput" class="flex-1 overflow-y-auto p-4 terminal-text text-sm bg-slate-950 text-green-400 scrollbar-hide">
                    <div class="mb-2">Microsoft Windows [版本 10.0.19045.3693]</div>
                    <div class="mb-2">(c) Microsoft Corporation。保留所有权利。</div>
                    <div class="mb-2">C:\Users\Remote></div>
                </div>
                <div class="p-3 border-t border-slate-700 bg-slate-900">
                    <div class="flex gap-2">
                        <span class="text-green-400 text-sm py-2">></span>
                        <input type="text" id="cmdInput" placeholder="输入命令..." class="flex-1 bg-transparent border-none text-sm text-white focus:outline-none font-mono" onkeypress="if(event.key==='Enter') executeCommand()">
                    </div>
                </div>
            </div>
        </aside>
    </div>
</div>

<!-- 被控端界面 -->
<div id="controlledUI" class="hidden h-full flex flex-col">
    <header class="glass-panel border-b border-slate-700 px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <i class="fas fa-shield-alt text-green-400 text-2xl"></i>
            <div>
                <h1 class="font-bold text-lg">被控模式</h1>
                <p class="text-xs text-slate-400">等待控制端连接</p>
            </div>
        </div>
        <button onclick="disconnect()" class="px-4 py-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 rounded-lg text-sm font-medium border border-red-600/30">
            停止共享
        </button>
    </header>

    <div class="flex-1 flex items-center justify-center p-8">
        <div class="max-w-2xl w-full">
            <div class="glass-panel rounded-2xl p-8 text-center border border-slate-700">
                <div class="w-24 h-24 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-check text-4xl text-green-400"></i>
                </div>
                
                <h2 class="text-2xl font-bold mb-2">设备已就绪</h2>
                <p class="text-slate-400 mb-6">您的设备正在等待远程连接</p>
                
                <div class="bg-slate-800 rounded-xl p-6 mb-6">
                    <p class="text-sm text-slate-400 mb-2">您的设备ID</p>
                    <div class="text-3xl font-mono font-bold text-blue-400 tracking-wider" id="myId">----</div>
                    <button onclick="copyId()" class="mt-3 text-xs text-blue-400 hover:text-blue-300">
                        <i class="fas fa-copy mr-1"></i>复制ID
                    </button>
                </div>

                <div class="grid grid-cols-3 gap-4 text-left">
                    <div class="bg-slate-800/50 rounded-lg p-4">
                        <i class="fas fa-eye text-blue-400 mb-2"></i>
                        <div class="text-sm font-medium">屏幕共享</div>
                        <div class="text-xs text-slate-500">实时传输画面</div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-4">
                        <i class="fas fa-keyboard text-purple-400 mb-2"></i>
                        <div class="text-sm font-medium">远程控制</div>
                        <div class="text-xs text-slate-500">键盘鼠标控制</div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-4">
                        <i class="fas fa-exchange-alt text-green-400 mb-2"></i>
                        <div class="text-sm font-medium">文件传输</div>
                        <div class="text-xs text-slate-500">双向文件交换</div>
                    </div>
                </div>

                <div class="mt-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg text-left">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-exclamation-triangle text-yellow-400 mt-1"></i>
                        <div class="text-sm text-yellow-200">
                            <strong>安全提示:</strong> 仅与您信任的人分享此ID。连接期间，对方可以看到您的屏幕并控制您的鼠标和键盘。
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// 全局状态
let currentRole = null;
let ws = null;
let peerConnection = null;
let dataChannel = null;
let sessionId = generateId();
let isConnected = false;
let screenCanvas = document.getElementById('remoteScreen');
let ctx = screenCanvas.getContext('2d');
let frameCount = 0;
let lastTime = Date.now();

// 生成随机ID
function generateId() {
    return Math.random().toString(36).substring(2, 8).toUpperCase();
}

// 选择角色
function selectRole(role) {
    currentRole = role;
    document.getElementById('roleSelection').classList.add('hidden');
    
    if (role === 'controller') {
        document.getElementById('controllerUI').classList.remove('hidden');
        document.getElementById('sessionId').textContent = sessionId;
        initializeController();
    } else {
        document.getElementById('controlledUI').classList.remove('hidden');
        document.getElementById('myId').textContent = sessionId;
        initializeControlled();
    }
}

// 初始化控制端
function initializeController() {
    setupCanvasInteraction();
    // 模拟WebSocket连接
    simulateConnection();
}

// 初始化被控端
function initializeControlled() {
    simulateConnection();
    startScreenCapture();
}

// 模拟连接（实际应用中应使用真实的WebSocket服务器）
function simulateConnection() {
    setTimeout(() => {
        updateConnectionStatus(true);
    }, 1000);
}

// 更新连接状态
function updateConnectionStatus(connected) {
    isConnected = connected;
    const dot = document.getElementById('connectionStatus');
    if (connected) {
        dot.classList.remove('bg-red-500');
        dot.classList.add('bg-green-500');
    } else {
        dot.classList.remove('bg-green-500');
        dot.classList.add('bg-red-500');
    }
}

// 设置画布交互
function setupCanvasInteraction() {
    const canvas = document.getElementById('remoteScreen');
    let isDragging = false;
    
    canvas.addEventListener('mousedown', (e) => {
        isDragging = true;
        sendMouseEvent('mousedown', e);
    });
    
    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = Math.floor((e.clientX - rect.left) * (1920 / rect.width));
        const y = Math.floor((e.clientY - rect.top) * (1080 / rect.height));
        document.getElementById('mousePos').textContent = `${x}, ${y}`;
        
        if (isDragging || currentRole === 'controller') {
            sendMouseEvent('mousemove', e);
        }
    });
    
    canvas.addEventListener('mouseup', (e) => {
        isDragging = false;
        sendMouseEvent('mouseup', e);
    });
    
    canvas.addEventListener('click', (e) => {
        sendMouseEvent('click', e);
    });
    
    canvas.addEventListener('dblclick', (e) => {
        sendMouseEvent('dblclick', e);
    });
    
    canvas.addEventListener('wheel', (e) => {
        e.preventDefault();
        sendMouseEvent('wheel', e);
    });
    
    // 键盘事件
    document.addEventListener('keydown', (e) => {
        if (currentRole === 'controller' && document.activeElement.tagName !== 'INPUT') {
            sendKeyEvent('keydown', e);
        }
    });
    
    document.addEventListener('keyup', (e) => {
        if (currentRole === 'controller' && document.activeElement.tagName !== 'INPUT') {
            sendKeyEvent('keyup', e);
        }
    });
}

// 发送鼠标事件
function sendMouseEvent(type, e) {
    if (!isConnected) return;
    
    const canvas = document.getElementById('remoteScreen');
    const rect = canvas.getBoundingClientRect();
    const scaleX = 1920 / rect.width;
    const scaleY = 1080 / rect.height;
    
    const data = {
        type: 'mouse',
        event: type,
        x: Math.floor((e.clientX - rect.left) * scaleX),
        y: Math.floor((e.clientY - rect.top) * scaleY),
        button: e.button,
        deltaY: e.deltaY || 0
    };
    
    console.log('发送鼠标事件:', data);
    // 实际应用中通过WebSocket发送
}

// 发送键盘事件
function sendKeyEvent(type, e) {
    if (!isConnected) return;
    
    const data = {
        type: 'keyboard',
        event: type,
        key: e.key,
        code: e.code,
        ctrl: e.ctrlKey,
        alt: e.altKey,
        shift: e.shiftKey,
        meta: e.metaKey
    };
    
    console.log('发送键盘事件:', data);
    e.preventDefault();
}

// 连接目标
function connectToTarget() {
    const targetId = document.getElementById('targetId').value.trim();
    if (!targetId) {
        alert('请输入被控端ID');
        return;
    }
    
    // 模拟连接过程
    document.getElementById('waitingScreen').innerHTML = `
        <div class="text-center">
            <i class="fas fa-circle-notch fa-spin text-4xl text-blue-500 mb-4"></i>
            <p class="text-slate-400">正在连接到 ${targetId}...</p>
        </div>
    `;
    
    setTimeout(() => {
        document.getElementById('waitingScreen').classList.add('hidden');
        startReceivingScreen();
    }, 1500);
}

// 开始接收屏幕（模拟）
function startReceivingScreen() {
    const canvas = document.getElementById('remoteScreen');
    const ctx = canvas.getContext('2d');
    canvas.width = 1920;
    canvas.height = 1080;
    
    document.getElementById('resolution').textContent = '分辨率: 1920x1080';
    
    // 模拟接收屏幕画面
    function drawFrame() {
        if (!isConnected) return;
        
        // 生成模拟桌面画面
        ctx.fillStyle = '#1e293b';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // 绘制模拟任务栏
        ctx.fillStyle = '#0f172a';
        ctx.fillRect(0, canvas.height - 40, canvas.width, 40);
        
        // 绘制模拟窗口
        ctx.fillStyle = '#334155';
        ctx.fillRect(100, 100, 800, 600);
        ctx.fillStyle = '#1e293b';
        ctx.fillRect(100, 100, 800, 30);
        ctx.fillStyle = '#94a3b8';
        ctx.font = '14px Arial';
        ctx.fillText('远程桌面 - 文档.txt', 110, 120);
        
        // 绘制模拟内容
        ctx.fillStyle = '#cbd5e1';
        for (let i = 0; i < 10; i++) {
            ctx.fillRect(120, 150 + i * 40, 600, 20);
        }
        
        // 绘制鼠标轨迹（模拟）
        const time = Date.now() / 1000;
        const mouseX = 800 + Math.sin(time) * 200;
        const mouseY = 400 + Math.cos(time * 1.5) * 100;
        
        ctx.fillStyle = 'white';
        ctx.beginPath();
        ctx.arc(mouseX, mouseY, 5, 0, Math.PI * 2);
        ctx.fill();
        
        // 计算FPS
        frameCount++;
        const now = Date.now();
        if (now - lastTime >= 1000) {
            document.getElementById('fps').textContent = `FPS: ${frameCount}`;
            document.getElementById('latency').textContent = `延迟: ${Math.floor(Math.random() * 20 + 10)}ms`;
            frameCount = 0;
            lastTime = now;
        }
        
        requestAnimationFrame(drawFrame);
    }
    
    drawFrame();
}

// 开始屏幕捕获（被控端）
function startScreenCapture() {
    // 实际应用中使用 getDisplayMedia API
    if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {
        navigator.mediaDevices.getDisplayMedia({ video: true })
            .then(stream => {
                console.log('屏幕捕获已开始');
                // 处理视频流...
            })
            .catch(err => {
                console.log('屏幕捕获被拒绝:', err);
            });
    }
}

// 请求刷新屏幕
function requestScreen() {
    console.log('请求刷新屏幕');
    // 发送刷新请求
}

// 快捷操作
function sendCtrlAltDel() {
    console.log('发送 Ctrl+Alt+Del');
}

function lockScreen() {
    console.log('锁定屏幕');
}

function muteRemote() {
    console.log('远程静音');
}

function openTaskManager() {
    console.log('打开任务管理器');
}

// 文件传输
function handleDragOver(e) {
    e.preventDefault();
    e.currentTarget.classList.add('drag-active');
}

function handleDragLeave(e) {
    e.currentTarget.classList.remove('drag-active');
}

function handleDrop(e) {
    e.preventDefault();
    e.currentTarget.classList.remove('drag-active');
    const files = e.dataTransfer.files;
    handleFiles(files);
}

function handleFileSelect(e) {
    const files = e.target.files;
    handleFiles(files);
}

function handleFiles(files) {
    const list = document.getElementById('transferList');
    
    Array.from(files).forEach(file => {
        const item = document.createElement('div');
        item.className = 'bg-slate-800 rounded p-2 flex items-center gap-2 text-xs';
        item.innerHTML = `
            <i class="fas fa-file text-blue-400"></i>
            <span class="flex-1 truncate">${file.name}</span>
            <span class="text-slate-500">${formatSize(file.size)}</span>
            <div class="w-16 h-1 bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full bg-blue-500 transition-all duration-300" style="width: 0%" id="progress-${file.name}"></div>
            </div>
        `;
        list.appendChild(item);
        
        // 模拟上传进度
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 30;
            if (progress >= 100) {
                progress = 100;
                clearInterval(interval);
            }
            const bar = item.querySelector(`#progress-${file.name}`);
            if (bar) bar.style.width = progress + '%';
        }, 500);
    });
}

function formatSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// 聊天功能
function switchTab(tab) {
    const chatPanel = document.getElementById('chatPanel');
    const cmdPanel = document.getElementById('cmdPanel');
    const tabChat = document.getElementById('tabChat');
    const tabCmd = document.getElementById('tabCmd');
    
    if (tab === 'chat') {
        chatPanel.classList.remove('hidden');
        cmdPanel.classList.add('hidden');
        tabChat.classList.add('text-blue-400', 'border-b-2', 'border-blue-400');
        tabChat.classList.remove('text-slate-400');
        tabCmd.classList.remove('text-blue-400', 'border-b-2', 'border-blue-400');
        tabCmd.classList.add('text-slate-400');
    } else {
        chatPanel.classList.add('hidden');
        cmdPanel.classList.remove('hidden');
        tabCmd.classList.add('text-blue-400', 'border-b-2', 'border-blue-400');
        tabCmd.classList.remove('text-slate-400');
        tabChat.classList.remove('text-blue-400', 'border-b-2', 'border-blue-400');
        tabChat.classList.add('text-slate-400');
    }
}

function sendChat() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    if (!message) return;
    
    addChatMessage('我', message, 'blue');
    input.value = '';
    
    // 模拟回复
    setTimeout(() => {
        addChatMessage('远程用户', '收到消息: ' + message, 'green');
    }, 1000);
}

function addChatMessage(sender, text, color) {
    const container = document.getElementById('chatMessages');
    const div = document.createElement('div');
    div.className = `flex flex-col ${sender === '我' ? 'items-end' : 'items-start'}`;
    div.innerHTML = `
        <span class="text-xs text-slate-500 mb-1">${sender}</span>
        <div class="max-w-[80%] px-3 py-2 rounded-lg ${sender === '我' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-200'} text-sm">
            ${text}
        </div>
    `;
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
}

// 终端命令
function executeCommand() {
    const input = document.getElementById('cmdInput');
    const command = input.value.trim();
    if (!command) return;
    
    const output = document.getElementById('terminalOutput');
    const line = document.createElement('div');
    line.className = 'mb-1';
    line.innerHTML = `<span class="text-blue-400">C:\\Users\\Remote></span> ${command}`;
    output.appendChild(line);
    
    input.value = '';
    
    // 模拟命令执行
    setTimeout(() => {
        const response = document.createElement('div');
        response.className = 'text-slate-300 mb-2';
        
        if (command.toLowerCase() === 'help') {
            response.innerHTML = '可用命令: dir, ipconfig, tasklist, systeminfo, cls';
        } else if (command.toLowerCase() === 'ipconfig') {
            response.innerHTML = 'IPv4 地址: 192.168.1.100<br>子网掩码: 255.255.255.0<br>默认网关: 192.168.1.1';
        } else if (command.toLowerCase() === 'dir') {
            response.innerHTML = '目录列表<br>2024/01/10  09:30    &lt;DIR&gt;          Documents<br>2024/01/10  09:30    &lt;DIR&gt;          Downloads';
        } else if (command.toLowerCase() === 'cls') {
            output.innerHTML = '';
            return;
        } else {
            response.textContent = `'${command}' 不是内部或外部命令，也不是可运行的程序`;
        }
        
        output.appendChild(response);
        output.scrollTop = output.scrollHeight;
    }, 300);
}

// 全屏切换
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
}

// 断开连接
function disconnect() {
    if (confirm('确定要断开连接吗？')) {
        location.reload();
    }
}

// 复制ID
function copyId() {
    const id = document.getElementById('myId').textContent;
    navigator.clipboard.writeText(id).then(() => {
        alert('ID已复制到剪贴板: ' + id);
    });
}

// 防止页面关闭时未保存
window.onbeforeunload = function() {
    if (isConnected) {
        return '您有正在进行的远程连接，确定要离开吗？';
    }
};
</script>

</body>
</html>